function HTTPRequest ( ){this.xmlHttpRequest = null;this.timeout = 0;this.cache = false;this.url = null;this.method = 'GET';this.async = true;this.username = null;this.password = null;this.parameters = new Object( );this.requestIndex = HTTPRequest.length ++;this.responseReceived = false;this.groupName = null;this.queryString = '';this.responseText = null;this.responseXML = null;this.status = null;this.statusText = null;this.aborted = false;this.onTimeout = null; this.onChangeState = null;this.onLoading = null;this.onLoaded = null;this.onInteractive = null;this.onComplete = null;this.onSuccess = null;this.onCached = null;this.onError = null;this.onGroupBegin = null;this.onGroupEnd = null;this.xmlHttpRequest = HTTPRequest.CreateXMLHTTPRequest( );if ( !this.xmlHttpRequest )return null;this.onLoadingInternalHandled = false;this.onLoadedInternalHandled = false;this.onInteractiveInternalHandled = false;this.onCompleteInternalHandled = false;this.onLoadingInternal = function( ){if ( this.onLoadingInternalHandled )return;HTTPRequest.activeRequests ++;if ( HTTPRequest.activeRequests == 1 && typeof( window['HTTPRequestBegin'] ) == 'function' )HTTPRequestBegin( );if ( this.groupName != null ){if ( typeof( HTTPRequest.ActiveHTTPGroupRequests[this.groupName] ) == 'undefined' )HTTPRequest.activeHTTPGroupRequests[this.groupName] = 0;HTTPRequest.activeHTTPGroupRequests[this.groupName]++;if ( HTTPRequest.activeHTTPGroupRequests[this.groupName]==1 && typeof( this.onGroupBegin ) == 'function' )this.onGroupBegin( this.groupName );}if ( typeof( this.onChangeState ) == 'function' )this.onChangeState( this );if ( typeof( this.onLoading ) == 'function' )this.onLoading( this );this.onLoadingInternalHandled = true;};
this.onLoadedInternal = function( ) {if ( this.onLoadedInternalHandled )return;if ( typeof( this.onChangeState ) == 'function' )this.onChangeState( this );if ( typeof( this.onLoaded ) == 'function' )this.onLoaded( this );this.onLoadedInternalHandled = true;};
this.onInteractiveInternal = function( ){if ( this.onInteractiveInternalHandled )return;if ( typeof( this.onChangeState ) == 'function' )this.onChangeState( this );if ( typeof( this.onInteractive ) == 'function' )this.onInteractive( this );this.onInteractiveInternalHandled = true;};
this.onCompleteInternal = function( ){if ( this.onCompleteInternalHandled || this.aborted )return;this.onCompleteInternalHandled = true;HTTPRequest.activeHTTPRequests--;if ( HTTPRequest.activeHTTPRequests == 0 && typeof( window['HTTPRequestEnd'] ) == 'function' )HTTPRequestEnd( );if ( this.groupName != null ){HTTPRequest.activeHTTPGroupRequests[this.groupName]--;if ( HTTPRequest.activeHTTPGroupRequests[this.groupName]==0 && typeof( this.onGroupEnd ) == 'function' )this.onGroupEnd( this.groupName );}this.responseReceived = true;this.status = this.xmlHttpRequest.status;this.statusText = this.xmlHttpRequest.statusText;this.responseText = this.xmlHttpRequest.responseText;this.responseXML = this.xmlHttpRequest.responseXML;if ( typeof( this.onChangeState ) == 'function' )this.onChangeState( this );if ( typeof( this.onComplete ) == 'function' )this.onComplete( this );if ( this.xmlHttpRequest.status == 200 ){if ( typeof( this.onSuccess ) == 'function' )this.onSuccess( this );}else if ( this.xmlHttpRequest.status == 304 ){if ( typeof( this.onCached ) == 'function' )this.onCached( this );else if ( typeof( this.onSuccess ) == 'function' )this.onSuccess( this );}else if ( typeof( this.onError ) == 'function' )this.onError( this );delete this.xmlHttpRequest['onreadystatechange'];this.xmlHttpRequest = null;};
this.onTimeoutInternal = function( ){if ( this.xmlHttpRequest != null && !this.onCompleteInternalHandled ){this.aborted = true;this.xmlHttpRequest.abort( );HTTPRequest.activeHTTPRequests--;if ( HTTPRequest.activeHTTPRequests == 0 && typeof( window['HTTPRequestEnd'] ) == 'function' )HTTPRequestEnd( );if ( this.groupName != null ){HTTPRequest.activeHTTPGroupRequests[this.groupName]--;if ( HTTPRequest.activeHTTPGroupRequests[this.groupName]==0 && typeof( this.onGroupEnd ) == 'function' )this.onGroupEnd( this.groupName );}if ( typeof( this.onTimeout ) == 'function' )this.onTimeout( this );delete this.xmlHttpRequest['onreadystatechange'];this.xmlHttpRequest = null;}};
var tmp = this;this.onreadystatechange = this.xmlHttpRequest.onreadystatechange = function ( ){if ( tmp.xmlHttpRequest == null )return;tmp.readyState = tmp.xmlHttpRequest.readyState;switch ( tmp.readyState ){case 0:tmp.statusText = '¡Page NOT Found!';if ( typeof( tmp.onError ) == 'function' )tmp.onError( tmp.xmlHttpRequest );break;case 1:tmp.onLoadingInternal( tmp.xmlHttpRequest );break;case 2:tmp.onLoadedInternal( tmp.xmlHttpRequest );break;case 3:tmp.onInteractiveInternal( tmp.xmlHttpRequest );break;case 4:tmp.onCompleteInternal( tmp.xmlHttpRequest );}};return this;};
HTTPRequest.prototype.process = function( ){if ( this.xmlHttpRequest != null && this.url != null ){if ( !this.cache && this.method == 'GET' )this.parameters['cache'] = new Date( ).getTime( ) + '' + this.requestIndex;var content = null;for ( var i in this.parameters ){if ( this.queryString.length > 0 )this.queryString += '&amp;';this.queryString += encodeURIComponent( i ) + '=' + encodeURIComponent( this.parameters[i] );}if ( this.method == 'GET' ){if ( this.queryString.length > 0 )this.url += ( ( this.url.indexOf( '?' ) > -1 ) ? '&amp;' : '?' ) + this.queryString;}this.xmlHttpRequest.open( this.method, this.url, this.async, this.username, this.password );if ( this.method == 'POST' ){if ( typeof( this.xmlHttpRequest.setRequestHeader ) != 'undefined' )this.xmlHttpRequest.setRequestHeader( 'Content-type', 'application/x-www-form-urlencoded' );content = this.queryString;}this.xmlHttpRequest.send( content );if ( !this.async )this.onreadystatechange( );else if ( this.timeout > 0 )setTimeout( this.onTimeoutInternal , this.timeout );}};
HTTPRequest.prototype.handleArguments = function( args ){for ( var i in args ){if ( typeof( this[i] ) == 'undefined' ){this.parameters[i] = args[i];}else{this[i] = args[i];}}};
HTTPRequest.prototype.getResponseHeaders = function( ){if ( this.xmlHttpRequest != null && this.responseReceived ){return this.xmlHttpRequest.getAllResponseHeaders( );}else return null;};
HTTPRequest.prototype.getResponseHeader = function( headerName ){if ( this.xmlHttpRequest != null && req.responseReceived )return this.xmlHttpRequest.getResponseHeader( headerName );else return null;};
HTTPRequest.requests = 0;HTTPRequest.activeRequests = 0;HTTPRequest.ActiveHTTPGroupRequests = new Object( );HTTPRequest.CreateXMLHTTPRequest = function( ){var request = null;if ( window.XMLHttpRequest )request = new XMLHttpRequest( );else if ( window.ActiveXObject ){try{request = new ActiveXObject( 'Msxml2.XMLHTTP' );}catch ( e ){}if ( !request ){try{request = new ActiveXObject( 'Microsoft.XMLHTTP' );}catch ( e ) {}}}return request;};
HTTPRequest.isActive = function( ){return ( HTTPRequest.activeHTTPRequests > 0 );};
HTTPRequest.get = function( args ){return HTTPRequest.doRequest( 'GET', args );};
HTTPRequest.post = function( args ) {return HTTPRequest.doRequest( 'POST', args );};
HTTPRequest.doRequest = function( method, args ){if ( typeof( args ) != 'undefined' && args != null ){var myRequest = new HTTPRequest( );if ( myRequest != null ){myRequest.method = method;myRequest.handleArguments( args );myRequest.process( );return myRequest;}}return null;};
HTTPRequest.submit = function( theform, args ){var myRequest = new HTTPRequest( );if ( myRequest != null ){var serializedForm = HTTPRequest.serializeForm( theform );myRequest.method = theform.method.toUpperCase( );myRequest.url = theform.action;myRequest.handleArguments( args );myRequest.queryString = serializedForm;myRequest.process( );}return myRequest;};
HTTPRequest.serializeForm = function( theform ){var els = theform.elements;var len = els.length;var queryString = '';this.addField = function( name, value ){ if ( queryString.length > 0 )queryString += '&amp;';queryString += encodeURIComponent( name ) + '=' + encodeURIComponent( value );};for ( var c = 0; c < len; c ++ ){var el = els[c];if ( !el.disabled ){switch( el.type ){case 'text': case 'password': case 'hidden': case 'textarea': this.addField( el.name, el.value );break;case 'select-one':if ( el.selectedIndex >= 0 )this.addField( el.name, el.options[el.selectedIndex].value );break;case 'select-multiple':for (var i = 0; i < el.options.length; i ++ )if ( el.options[i].selected )this.addField( el.name, el.options[j].value );break;case 'checkbox': case 'radio':if ( el.checked )this.addField( el.name, el.value );break;}}}return queryString;};
function fatalError ( ){if ( confirm( '¿Peticion no procesada!\nIntentar recargar la pagina?' ) )document.location.href = document.location;};
function validateInJS ( keyword, filename ){if ( eval( 'typeof ( ' + keyword + ' )' ) == 'undefined' ){var file = HTTPRequest.get ( { 'url' : 'include/' + filename + '.js', 'async' : false, 'cache' : true, 'onError' : fatalError } );return file.responseText;}return '';};
